<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
	      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Screen Capture API</title>
	<style>
		video {
			border: 1px solid;
			margin: 20px;
			max-width: 500px;
			max-height: 500px;
			object-fit: contain;
		}
	</style>
</head>
<body>
<div>
	<video autoplay id="stream">
	</video>
	<video id="preview" controls autoplay hidden></video>
</div>
<button id="start">Start</button>
<button id="stop">Stop</button>
<br/>
<a href="" download="video">Download</a>
</body>
<script>
	const start = document.getElementById('start');
	const stop = document.getElementById('stop');
	const videoStream = document.getElementById('stream');
	const videoPreview = document.getElementById('preview');
	const download = document.querySelector('a[download]');

	start.addEventListener('click', async () => {
		const stream = await navigator.mediaDevices.getDisplayMedia({
			audio: true,
			video: {
				displaySurface: 'browser', // displaySurface options: 'browser' | 'window' | 'monitor'â†’ Default content option
			}
		});
		videoStream.srcObject = stream;
		const mimeType = 'video/mp4;codecs=avc1';

		const recorder = new MediaRecorder(stream, { mimeType });
		recorder.start(1);
		recorder.onstart = () => {
			videoStream.hidden = false;
			videoPreview.hidden = true;
			const data = [];
			recorder.ondataavailable = e => data.push(e.data);
			recorder.onstop = () => {
				videoStream.hidden = true;
				videoPreview.hidden = false;
				const url = URL.createObjectURL(new Blob(data, { type: mimeType }));
				videoPreview.src = url;
				download.href = url;
			};
		};
	});

	stop.addEventListener('click', async () => {
		const tracks = videoStream.srcObject?.getTracks();
		tracks.forEach(track => track.stop());
	});

</script>
</html>
